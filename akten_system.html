<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Akten System - Polizei Netzwerk</title>
<style>
  /* Grundlayout mit Sidebar */
  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background: #f0f2f5;
    color: #222;
    display: flex;
    height: 100vh;
  }
  /* Sidebar Styling */
  nav.sidebar {
    width: 220px;
    background-color: #2c3e50;
    color: #ecf0f1;
    display: flex;
    flex-direction: column;
    padding: 20px;
  }
  nav.sidebar h2 {
    margin: 0 0 30px;
    font-weight: 700;
    font-size: 1.5em;
    letter-spacing: 1px;
  }
  nav.sidebar a {
    color: #ecf0f1;
    text-decoration: none;
    margin: 10px 0;
    font-weight: 600;
    padding: 10px;
    border-radius: 6px;
    transition: background-color 0.3s;
  }
  nav.sidebar a:hover, nav.sidebar a.active {
    background-color: #2980b9;
  }

  /* Hauptbereich */
  main.content {
    flex: 1;
    padding: 30px;
    overflow-y: auto;
  }
  main.content h1 {
    margin-top: 0;
    margin-bottom: 30px;
    font-weight: 700;
    font-size: 2em;
    color: #34495e;
  }

  /* Container des Aktenformulars */
  .container {
    max-width: 900px;
    margin: 0 auto;
    background: #fff;
    border-radius: 12px;
    padding: 25px 30px;
    box-shadow: 0 12px 30px rgba(0,0,0,0.1);
  }

  label {
    font-weight: 600;
    display: block;
    margin-bottom: 6px;
    color: #34495e;
  }
  input[type=text], input[type=date], input[type=tel], input[type=number], select, textarea {
    width: 100%;
    padding: 10px 12px;
    margin-bottom: 18px;
    border-radius: 8px;
    border: 1.5px solid #ccc;
    font-size: 15px;
    font-family: inherit;
    transition: border-color 0.3s;
  }
  input[type=text]:focus, input[type=date]:focus, input[type=tel]:focus, input[type=number]:focus, select:focus, textarea:focus {
    border-color: #2980b9;
    outline: none;
  }
  textarea {
    resize: vertical;
    min-height: 90px;
  }

  .row {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 15px;
  }
  .row > div {
    flex: 1;
    min-width: 160px;
  }

  button {
    background-color: #2980b9;
    color: white;
    border: none;
    padding: 12px 22px;
    margin-right: 12px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    font-size: 15px;
    transition: background-color 0.3s ease;
  }
  button:hover {
    background-color: #1a5276;
  }
  button.danger {
    background-color: #c0392b;
  }
  button.danger:hover {
    background-color: #8e2e23;
  }

  /* Aktenliste Styling */
  #aktenListe {
    margin-top: 40px;
  }
  .akte-item {
    border-bottom: 1px solid #ddd;
    padding: 15px 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }
  .akte-info {
    flex: 1 1 65%;
    color: #2c3e50;
    font-size: 15px;
  }
  .akte-actions button {
    margin-left: 10px;
    font-weight: 600;
  }

  #photoPreview {
    max-width: 140px;
    border-radius: 10px;
    margin-top: 12px;
    display: none;
    border: 1.5px solid #2980b9;
  }

  #filterInputs {
    margin-bottom: 30px;
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
  }
  #filterInputs > div {
    flex: 1;
    min-width: 220px;
  }

  /* Logs */
  .log-entry {
    background: #eaf3fb;
    border-left: 5px solid #2980b9;
    padding: 10px 14px;
    margin: 7px 0;
    font-size: 14px;
    border-radius: 6px;
    color: #34495e;
  }
  .log-container {
    max-height: 180px;
    overflow-y: auto;
    margin-top: 15px;
    border: 1.5px solid #ccc;
    padding: 12px;
    border-radius: 10px;
    background: #fafafa;
  }
  hr {
    border: none;
    border-top: 1.5px solid #ddd;
    margin: 28px 0;
  }
</style>
</head>
<body>

<nav class="sidebar">
  <h2>Polizei Netzwerk</h2>
  <a href="#" class="active">Akten System</a>
  <a href="#">Dashboard</a>
  <a href="#">Einstellungen</a>
  <a href="#">Logout</a>
</nav>

<main class="content">
  <div class="container">
    <h1>Akten System</h1>

    <!-- Schritt 1: Titel + Akte anlegen -->
    <div id="createAkteStep">
      <label for="akteTitel">Akten Titel (Name):</label>
      <input type="text" id="akteTitel" placeholder="Titel der Akte eingeben" autocomplete="off"/>
      <button id="btnCreateAkte">Akte anlegen</button>
    </div>

    <!-- Schritt 2: Akte erweitern -->
    <div id="editAkteStep" style="display:none;">
      <h2>Akte erweitern: <span id="aktTitelAnzeigen"></span> (ID: <span id="aktIdAnzeigen"></span>)</h2>

      <div class="row">
        <div>
          <label for="vorname">Vorname</label>
          <input type="text" id="vorname" autocomplete="off" />
        </div>
        <div>
          <label for="nachname">Nachname</label>
          <input type="text" id="nachname" autocomplete="off" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="geschlecht">Geschlecht</label>
          <select id="geschlecht">
            <option value="">-- Bitte wählen --</option>
            <option value="männlich">Männlich</option>
            <option value="weiblich">Weiblich</option>
            <option value="divers">Divers</option>
          </select>
        </div>
        <div>
          <label for="geburtsdatum">Geburtsdatum</label>
          <input type="date" id="geburtsdatum" />
        </div>
        <div>
          <label for="telefonnummer">Telefonnummer</label>
          <input type="tel" id="telefonnummer" autocomplete="off" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="groesse">Größe (cm)</label>
          <input type="number" id="groesse" min="30" max="300" />
        </div>
        <div>
          <label for="augenfarbe">Augenfarbe</label>
          <input type="text" id="augenfarbe" autocomplete="off" />
        </div>
        <div>
          <label for="haarfarbe">Haarfarbe</label>
          <input type="text" id="haarfarbe" autocomplete="off" />
        </div>
      </div>

      <div>
        <label for="sonstiges">Sonstiges</label>
        <textarea id="sonstiges" placeholder="Weitere Informationen"></textarea>
      </div>

      <hr />

      <!-- Straftat / Vermerk Auswahl -->
      <label for="eintragTyp">Eintrag hinzufügen:</label>
      <select id="eintragTyp">
        <option value="">-- auswählen --</option>
        <option value="straftat">Straftat</option>
        <option value="vermerk">Vermerk</option>
      </select>

      <input type="text" id="eintragText" placeholder="Beschreibung" autocomplete="off" style="width: calc(100% - 140px); margin-left: 10px;"/>
      <button id="btnEintragHinzufuegen">Hinzufügen</button>

      <hr />

      <!-- Foto Upload -->
      <label for="fotoUpload">Foto hinzufügen:</label>
      <input type="file" id="fotoUpload" accept="image/*" />
      <img id="photoPreview" alt="Vorschau Foto" />

      <hr />

      <button id="btnSpeichern">Speichern</button>
      <button id="btnAbbrechen" class="danger">Abbrechen</button>
    </div>

    <hr />

    <!-- Filter & Suche -->
    <div id="filterInputs">
      <div>
        <label for="filterTitel">Filtern nach Titel:</label>
        <input type="text" id="filterTitel" placeholder="Titel filtern" autocomplete="off"/>
      </div>
      <div>
        <label for="filterVorname">Filtern nach Vorname:</label>
        <input type="text" id="filterVorname" placeholder="Vorname filtern" autocomplete="off"/>
      </div>
      <div>
        <label for="filterNachname">Filtern nach Nachname:</label>
        <input type="text" id="filterNachname" placeholder="Nachname filtern" autocomplete="off"/>
      </div>
      <div>
        <label for="filterStraftat">Filtern nach Straftat:</label>
        <input type="text" id="filterStraftat" placeholder="Straftat filtern" autocomplete="off"/>
      </div>
    </div>

    <!-- Aktenliste -->
    <div id="aktenListe"></div>

    <hr />

    <!-- Logs anzeigen -->
    <h3>Logs</h3>
    <div id="logs" class="log-container"></div>
  </div>
</main>

<script>
  // Dummy-Datenbank in localStorage
  let aktenDB = JSON.parse(localStorage.getItem('aktenDB') || '[]');
  let aktuelleAkteId = null;

  const logContainer = document.getElementById('logs');

  function log(text) {
    const entry = document.createElement('div');
    entry.textContent = text;
    entry.className = 'log-entry';
    logContainer.prepend(entry);
  }

  // Funktionen
  function saveDB() {
    localStorage.setItem('aktenDB', JSON.stringify(aktenDB));
    log('Daten gespeichert.');
  }

  function renderAktenListe(filter = {}) {
    const liste = document.getElementById('aktenListe');
    liste.innerHTML = '';

    let gefilterteAkten = aktenDB.filter(akte => {
      if (filter.titel && !akte.titel.toLowerCase().includes(filter.titel.toLowerCase())) return false;
      if (filter.vorname && (!akte.vorname || !akte.vorname.toLowerCase().includes(filter.vorname.toLowerCase()))) return false;
      if (filter.nachname && (!akte.nachname || !akte.nachname.toLowerCase().includes(filter.nachname.toLowerCase()))) return false;
      if (filter.straftat) {
        if (!akte.eintraege || !akte.eintraege.some(e => e.typ === 'straftat' && e.text.toLowerCase().includes(filter.straftat.toLowerCase()))) return false;
      }
      return true;
    });

    if (gefilterteAkten.length === 0) {
      liste.innerHTML = '<p>Keine Akten gefunden.</p>';
      return;
    }

    gefilterteAkten.forEach(akte => {
      const div = document.createElement('div');
      div.className = 'akte-item';

      const info = document.createElement('div');
      info.className = 'akte-info';
      info.innerHTML = `<strong>${akte.titel}</strong> - ${akte.vorname || '-'} ${akte.nachname || '-'} (ID: ${akte.id})`;

      const actions = document.createElement('div');
      actions.className = 'akte-actions';

      const btnEdit = document.createElement('button');
      btnEdit.textContent = 'Bearbeiten';
      btnEdit.onclick = () => startEditAkte(akte.id);

      const btnDelete = document.createElement('button');
      btnDelete.textContent = 'Löschen';
      btnDelete.className = 'danger';
      btnDelete.onclick = () => {
        if (confirm('Akte wirklich löschen?')) {
          aktenDB = aktenDB.filter(a => a.id !== akte.id);
          saveDB();
          renderAktenListe();
          if (aktuelleAkteId === akte.id) resetForm();
          log(`Akte "${akte.titel}" gelöscht.`);
        }
      };

      actions.appendChild(btnEdit);
      actions.appendChild(btnDelete);

      div.appendChild(info);
      div.appendChild(actions);

      liste.appendChild(div);
    });
  }

  function resetForm() {
    aktuelleAkteId = null;
    document.getElementById('createAkteStep').style.display = 'block';
    document.getElementById('editAkteStep').style.display = 'none';
    document.getElementById('akteTitel').value = '';
    document.getElementById('aktTitelAnzeigen').textContent = '';
    document.getElementById('aktIdAnzeigen').textContent = '';

    // Formularfelder zurücksetzen
    ['vorname','nachname','geschlecht','geburtsdatum','telefonnummer','groesse','augenfarbe','haarfarbe','sonstiges','eintragTyp','eintragText'].forEach(id => {
      const el = document.getElementById(id);
      if(el) el.value = '';
    });
    document.getElementById('photoPreview').style.display = 'none';
    document.getElementById('fotoUpload').value = '';
  }

  function startEditAkte(id) {
    const akte = aktenDB.find(a => a.id === id);
    if (!akte) return;

    aktuelleAkteId = id;

    document.getElementById('createAkteStep').style.display = 'none';
    document.getElementById('editAkteStep').style.display = 'block';

    document.getElementById('aktTitelAnzeigen').textContent = akte.titel;
    document.getElementById('aktIdAnzeigen').textContent = akte.id;

    // Daten anzeigen
    ['vorname','nachname','geschlecht','geburtsdatum','telefonnummer','groesse','augenfarbe','haarfarbe','sonstiges'].forEach(id => {
      if (akte[id]) {
        document.getElementById(id).value = akte[id];
      } else {
        document.getElementById(id).value = '';
      }
    });

    if (akte.foto) {
      const img = document.getElementById('photoPreview');
      img.src = akte.foto;
      img.style.display = 'block';
    } else {
      document.getElementById('photoPreview').style.display = 'none';
    }

    // Einträge zurücksetzen
    document.getElementById('eintragTyp').value = '';
    document.getElementById('eintragText').value = '';
  }

  // Akte anlegen
  document.getElementById('btnCreateAkte').onclick = () => {
    const titel = document.getElementById('akteTitel').value.trim();
    if (!titel) {
      alert('Bitte einen Titel eingeben!');
      return;
    }
    const neueAkte = {
      id: Date.now(),
      titel,
      eintraege: []
    };
    aktenDB.push(neueAkte);
    saveDB();
    renderAktenListe();
    log(`Neue Akte "${titel}" angelegt.`);
    startEditAkte(neueAkte.id);
  };

  // Eintrag hinzufügen (Straftat / Vermerk)
  document.getElementById('btnEintragHinzufuegen').onclick = () => {
    if (!aktuelleAkteId) return alert('Keine Akte ausgewählt!');

    const typ = document.getElementById('eintragTyp').value;
    const text = document.getElementById('eintragText').value.trim();

    if (!typ || !text) {
      alert('Bitte Typ und Beschreibung eingeben!');
      return;
    }

    const akte = aktenDB.find(a => a.id === aktuelleAkteId);
    if (!akte.eintraege) akte.eintraege = [];
    akte.eintraege.push({typ, text});
    document.getElementById('eintragTyp').value = '';
    document.getElementById('eintragText').value = '';

    saveDB();
    log(`Eintrag (${typ}): "${text}" hinzugefügt.`);
  };

  // Speichern Button
  document.getElementById('btnSpeichern').onclick = () => {
    if (!aktuelleAkteId) return alert('Keine Akte ausgewählt!');

    const akte = aktenDB.find(a => a.id === aktuelleAkteId);
    if (!akte) return;

    // Felder speichern
    ['vorname','nachname','geschlecht','geburtsdatum','telefonnummer','groesse','augenfarbe','haarfarbe','sonstiges'].forEach(id => {
      akte[id] = document.getElementById(id).value.trim();
    });

    // Foto ist schon gespeichert bei Upload

    saveDB();
    renderAktenListe();
    log(`Akte "${akte.titel}" gespeichert.`);
    alert('Akte erfolgreich gespeichert!');
  };

  // Abbrechen Button
  document.getElementById('btnAbbrechen').onclick = () => {
    resetForm();
  };

  // Foto Upload
  document.getElementById('fotoUpload').onchange = (e) => {
    if (!aktuelleAkteId) {
      alert('Bitte zuerst eine Akte anlegen oder auswählen!');
      e.target.value = '';
      return;
    }
    const file = e.target.files[0];
    if (!file) return;

    if (!file.type.startsWith('image/')) {
      alert('Bitte eine Bilddatei auswählen!');
      e.target.value = '';
      return;
    }

    const reader = new FileReader();
    reader.onload = () => {
      const base64 = reader.result;
      const akte = aktenDB.find(a => a.id === aktuelleAkteId);
      akte.foto = base64;

      document.getElementById('photoPreview').src = base64;
      document.getElementById('photoPreview').style.display = 'block';

      saveDB();
      log('Foto hochgeladen und gespeichert.');
    };
    reader.readAsDataURL(file);
  };

  // Filter Inputs
  ['filterTitel','filterVorname','filterNachname','filterStraftat'].forEach(id => {
    document.getElementById(id).addEventListener('input', () => {
      const filter = {
        titel: document.getElementById('filterTitel').value.trim(),
        vorname: document.getElementById('filterVorname').value.trim(),
        nachname: document.getElementById('filterNachname').value.trim(),
        straftat: document.getElementById('filterStraftat').value.trim(),
      };
      renderAktenListe(filter);
    });
  });

  // Initial laden
  renderAktenListe();
</script>

</body>
</html>
